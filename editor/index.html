<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Particle System Editor</title>
    <link rel="stylesheet" href="main.css" />
    <link rel="stylesheet" href="jsoneditor.min.css" />
    <script src="../build/index.js"></script>
    <script src="e2.min.js"></script>
    <script src="canvas-helpers.js"></script>
    <script src="debug.js"></script>
    <script src="jsoneditor.min.js"></script>
    <script src="editor.js"></script>
  </head>
  <body>
    <main>
      <e2-app id="app" theme="dark">
        <section class="layout">
          <!-- Toolbar -->
          <header>
            <e2-toolbar>
              <e2-toolbar-button
                id="new-toolbar-button"
                label="New"
                icon="ðŸ“„"
                action="new"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="open-toolbar-button"
                label="Open"
                icon="ðŸ“"
                action="open"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="save-toolbar-button"
                label="Save"
                icon="ðŸ’¾"
                action="save"
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="undo-toolbar-button"
                label="Undo"
                icon="â†©ï¸"
                action="undo"
                disabled
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="redo-toolbar-button"
                label="Redo"
                icon="â†ªï¸"
                action="redo"
                disabled
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="new-emitter-toolbar-button"
                label="Emitter"
                icon="ðŸ’¥"
                action="new-emitter"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="new-attractor-toolbar-button"
                label="Attractor"
                icon="ðŸ§²"
                action="new-attractor"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="new-forcefield-toolbar-button"
                label="Force Field"
                icon="âž¡ï¸"
                action="new-forcefield"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="new-collider-toolbar-button"
                label="Collider"
                icon="â¬œ"
                action="new-collider"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="new-sink-toolbar-button"
                label="Sink"
                icon="ðŸ•³ï¸"
                action="new-sink"
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="delete-toolbar-button"
                label="Delete"
                icon="ðŸ—‘ï¸"
                action="delete"
                disabled
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="play-toolbar-button"
                label="Play"
                icon="â–¶ï¸"
                action="play"
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="pause-toolbar-button"
                label="Pause"
                icon="â¸ï¸"
                action="pause"
                disabled
              ></e2-toolbar-button>
              <e2-toolbar-button
                id="reset-toolbar-button"
                label="Reset"
                icon="ðŸ”„"
                action="reset"
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="toggle-elements-toolbar-button"
                label="Hide Elements"
                icon="ðŸ‘ï¸"
                action="toggle-elements"
              ></e2-toolbar-button>
              <e2-toolbar-separator></e2-toolbar-separator>
              <e2-toolbar-button
                id="settings-toolbar-button"
                label="Settings"
                icon="âš™ï¸"
                action="settings"
              ></e2-toolbar-button>
              <span class="spacer"></span>
              <label class="theme-switch">
                <input type="checkbox" />
                <span class="slider" data-off="ðŸŒž" data-on="ðŸŒ™"></span>
              </label>
            </e2-toolbar>
          </header>

          <section class="main">
            <!-- Tree view -->
            <aside class="tree">
              <e2-collapsible-panel orientation="horizontal" resize-right>
                <span slot="title">Scene Nodes</span>
                <e2-tree-view id="scene-tree" class="has-nodes"></e2-tree-view>
              </e2-collapsible-panel>
            </aside>

            <!-- Editor canvas -->
            <section class="content">
              <canvas id="editor-canvas" class="has-nodes"></canvas>
            </section>

            <!-- Properties panel -->
            <aside class="properties">
              <e2-collapsible-panel
                orientation="horizontal"
                resize-left
                collapsed
              >
                <span slot="title" id="properties-title">Properties</span>
                <div class="properties-container">
                  <e2-keyvalue-editor id="property-editor"></e2-keyvalue-editor>
                </div>
              </e2-collapsible-panel>
            </aside>

            <!-- History panel -->
            <aside class="history">
              <e2-collapsible-panel
                orientation="horizontal"
                resize-left
                collapsed
              >
                <span slot="title">History</span>
                <e2-list-view
                  id="history-list"
                  view-mode="details"
                ></e2-list-view>
              </e2-collapsible-panel>
            </aside>
          </section>

          <!-- Status bar -->
          <footer>
            <e2-status-bar id="status-bar">
              <e2-status-section slot="left" position="left">
                <e2-status-item
                  id="selected-status"
                  type="indicator"
                  label="Selected"
                  value="None"
                ></e2-status-item>
                <e2-status-item
                  id="mouse-status"
                  type="text"
                  label="Mouse"
                  value="(0, 0)"
                ></e2-status-item>
              </e2-status-section>
              <e2-status-section slot="right" position="right">
                <e2-status-item
                  id="particles-status"
                  type="text"
                  label="Particles"
                  value="0"
                ></e2-status-item>
                <e2-status-item
                  id="fps-status"
                  type="text"
                  label="FPS"
                  value="0"
                ></e2-status-item>
              </e2-status-section>
            </e2-status-bar>
          </footer>
        </section>

        <!-- Context menu -->
        <e2-context-menu target=".has-nodes">
          <e2-context-menu-item
            id="new-emitter-context-menu-item"
            label="New Emitter"
            icon="ðŸ’¥"
            action="new-emitter-context"
          ></e2-context-menu-item>
          <e2-context-menu-item
            id="new-attractor-context-menu-item"
            label="New Attractor"
            icon="ðŸ§²"
            action="new-attractor-context"
          ></e2-context-menu-item>
          <e2-context-menu-item
            id="new-forcefield-context-menu-item"
            label="New Force Field"
            icon="âž¡ï¸"
            action="new-forcefield-context"
          ></e2-context-menu-item>
          <e2-context-menu-item
            id="new-collider-context-menu-item"
            label="New Collider"
            icon="â¬œ"
            action="new-collider-context"
          ></e2-context-menu-item>
          <e2-context-menu-item
            id="new-sink-context-menu-item"
            label="New Sink"
            icon="ðŸ•³ï¸"
            action="new-sink-context"
          ></e2-context-menu-item>
          <e2-context-menu-separator id="context-separator-1"></e2-context-menu-separator>
          <e2-context-menu-item
            id="load-image-context-menu-item"
            label="Load Image"
            icon="ðŸ–¼ï¸"
            action="load-image-context"
          ></e2-context-menu-item>
          <e2-context-menu-separator id="context-separator-2"></e2-context-menu-separator>
          <e2-context-menu-item
            id="delete-context-menu-item"
            label="Delete"
            icon="ðŸ—‘ï¸"
            action="delete-context"
          ></e2-context-menu-item>
        </e2-context-menu>

        <!-- Notification container -->
        <e2-notification-container
          id="notification-container"
          position="bottom-right"
          max-notifications="5"
          stack-direction="up"
          spacing="medium"
        >
        </e2-notification-container>

        <!-- Name prompt -->
        <e2-prompt
          id="name-prompt"
          title="Particle System Name"
          label="Enter a name for the particle system:"
          placeholder="Particle System name..."
          required="true"
        ></e2-prompt>

        <!-- Image ID prompt -->
        <e2-prompt
          id="image-id-prompt"
          title="Image ID"
          label="Enter a unique ID for this image:"
          placeholder="image-id"
          required="true"
        ></e2-prompt>

        <!-- Hidden file input for image loading -->
        <input type="file" id="image-file-input" accept="image/*" style="display: none;" />

        <!-- Settings dialog -->
        <e2-dialog id="settings-dialog" title="Settings" closable theme="dark">
          <e2-keyvalue-editor id="settings-editor"></e2-keyvalue-editor>
          <div slot="footer">
            <button id="close-settings-dialog-button">Close</button>
          </div>
        </e2-dialog>

        <!-- Particle Options dialog -->
        <e2-dialog id="particle-options-dialog" title="Particle Options" closable theme="dark">
          <div class="options-dialog-container">
            <div class="options-dialog-docs">
              <h3>Particle Configuration</h3>
              <p>Configure how particles are generated and behave.</p>

              <h4>Position Distribution</h4>
              <ul>
                <li><code>uniform</code> - Particles spawn uniformly across emitter area</li>
                <li><code>normal</code> - Particles spawn with normal (gaussian) distribution</li>
              </ul>

              <h4>Speed, Direction, Size</h4>
              <p>Can be single values or ranges:</p>
              <ul>
                <li>Single number: <code>100</code></li>
                <li>Number range: <code>{ "min": 50, "max": 150 }</code></li>
                <li>Single vec2 (size): <code>{ "x": 10, "y": 10 }</code></li>
                <li>Vec2 range (size): <code>{ "min": { "x": 5, "y": 5 }, "max": { "x": 20, "y": 20 } }</code></li>
              </ul>

              <h4>Rotation</h4>
              <ul>
                <li><code>null</code> - Auto-calculate from velocity</li>
                <li>Number/Range - Rotation in radians</li>
              </ul>

              <h4>Style Types</h4>

              <h5>Dot Style</h5>
              <pre><code>{
  "style": "dot",
  "color": "#ff0000",
  "glow": {
    "color": "#ff8800",
    "amount": 10
  }
}</code></pre>
              <ul>
                <li><code>color</code> - Required. Particle color(s)</li>
                <li><code>glow</code> - Optional. Adds glow effect with color and amount</li>
              </ul>

              <h5>Radial Style</h5>
              <pre><code>{
  "style": "radial",
  "color": ["#ff0000", "#ffff00"]
}</code></pre>
              <ul>
                <li><code>color</code> - Required. Radial gradient color(s)</li>
              </ul>

              <h5>Line Style</h5>
              <pre><code>{
  "style": "line",
  "color": "#00ff00",
  "rotationOffset": 1.57,
  "glow": {
    "color": "#88ff88",
    "amount": 5
  }
}</code></pre>
              <ul>
                <li><code>color</code> - Required. Line color(s)</li>
                <li><code>rotationOffset</code> - Optional. Additional rotation in radians</li>
                <li><code>glow</code> - Optional. Adds glow effect</li>
              </ul>

              <h5>Image Style</h5>
              <pre><code>{
  "style": "image",
  "image": "path/to/image.png",
  "rotationOffset": 0
}</code></pre>
              <ul>
                <li><code>image</code> - Required. Path or URL to image (string or HTMLImageElement)</li>
                <li><code>rotationOffset</code> - Optional. Additional rotation in radians</li>
              </ul>

              <h4>Colors</h4>
              <p>Single color or array for random selection:</p>
              <ul>
                <li>Single: <code>"#ff0000"</code></li>
                <li>Multiple: <code>["#ff0000", "#00ff00", "#0000ff"]</code></li>
              </ul>

              <h4>Fade</h4>
              <p>Fade in/out times in seconds (applies to all styles):</p>
              <pre><code>{
  "fade": {
    "in": 0.5,
    "out": 1.0
  }
}</code></pre>

              <h4>Trail</h4>
              <p>Optional particle trail effect (applies to all styles):</p>
              <pre><code>{
  "trail": {
    "length": 10,
    "color": "#ff0000",
    "width": 2,
    "widthDecay": 0.8,
    "alphaDecay": 0.8,
    "decayTime": 0.5
  }
}</code></pre>
              <ul>
                <li><code>length</code> - Required. Number of trail segments</li>
                <li><code>color</code> - Optional. Trail color override (otherwise uses particle color)</li>
                <li><code>width</code> - Optional. Trail width in pixels</li>
                <li><code>widthDecay</code> - Optional. 0=no decay, 1=full decay, negative=grow</li>
                <li><code>alphaDecay</code> - Optional. 0=no decay, 1=full decay along trail length</li>
                <li><code>decayTime</code> - Optional. Time in seconds for trail to fade (default: 0.5)</li>
              </ul>

              <h4>Options</h4>
              <ul>
                <li><code>useAttractors</code> - Control attractor effects:
                  <ul>
                    <li><code>false</code> - Not affected by any attractors</li>
                    <li><code>true</code> - Affected by all attractors</li>
                    <li><code>"id"</code> - Affected only by attractor with this id</li>
                    <li><code>["id1", "id2"]</code> - Affected only by attractors with these ids</li>
                  </ul>
                </li>
                <li><code>useForceFields</code> - Control force field effects (same format as useAttractors)</li>
                <li><code>useColliders</code> - Control collider interactions (same format as useAttractors)</li>
                <li><code>useSinks</code> - Control sink effects (same format as useAttractors)</li>
                <li><code>maxSpeed</code> - Maximum velocity magnitude (use -1 for no limit)</li>
                <li><code>defaultUpdates</code> - Which default updates to run: <code>"all"</code>, <code>"none"</code>, or array</li>
                <li><code>defaultDraws</code> - Which default draws to run: <code>"all"</code>, <code>"none"</code>, or array</li>
              </ul>
            </div>
            <div class="options-dialog-editor">
              <div id="particle-options-json-editor"></div>
            </div>
          </div>
          <div slot="footer">
            <button id="particle-options-ok-button">OK</button>
            <button id="particle-options-cancel-button">Cancel</button>
          </div>
        </e2-dialog>

        <!-- Emission Options dialog -->
        <e2-dialog id="emission-options-dialog" title="Emission Options" closable theme="dark">
          <div class="options-dialog-container">
            <div class="options-dialog-docs">
              <h3>Emission Configuration</h3>
              <p>Configure how particles are emitted over time.</p>

              <h4>Emission Types</h4>

              <h5>Rate Emission</h5>
              <p>Continuously emits particles at a specified rate:</p>
              <pre><code>{
  "type": "rate",
  "rate": 10
}</code></pre>
              <ul>
                <li><code>rate</code> - Particles per second (can be number or range)</li>
                <li>Single value: <code>10</code></li>
                <li>Range: <code>{ "min": 5, "max": 15 }</code></li>
              </ul>

              <h5>Burst Emission</h5>
              <p>Emits a specific number of particles at once:</p>
              <pre><code>{
  "type": "burst",
  "n": 50,
  "delay": 0
}</code></pre>
              <ul>
                <li><code>n</code> - Number of particles to emit (can be number or range)</li>
                <li><code>delay</code> - Optional delay before burst in seconds (default: 0)</li>
                <li>Single value: <code>50</code></li>
                <li>Range: <code>{ "min": 30, "max": 70 }</code></li>
              </ul>

              <h5>Custom Emission</h5>
              <p>Use custom logic for emission (advanced):</p>
              <pre><code>{
  "type": "custom",
  "f": "function() { return 1; }"
}</code></pre>
              <p><strong>Note:</strong> Custom functions cannot be edited in JSON format.</p>

              <h4>Examples</h4>
              <pre><code>// Steady stream
{ "type": "rate", "rate": 20 }

// Variable rate
{
  "type": "rate",
  "rate": { "min": 10, "max": 30 }
}

// Single burst
{ "type": "burst", "n": 100 }

// Delayed burst
{
  "type": "burst",
  "n": 50,
  "delay": 2.0
}</code></pre>
            </div>
            <div class="options-dialog-editor">
              <div id="emission-options-json-editor"></div>
            </div>
          </div>
          <div slot="footer">
            <button id="emission-options-ok-button">OK</button>
            <button id="emission-options-cancel-button">Cancel</button>
          </div>
        </e2-dialog>

        <!-- Custom Force Parameters dialog -->
        <e2-dialog id="custom-force-params-dialog" title="Custom Force Parameters" closable theme="dark">
          <div class="options-dialog-container">
            <div class="options-dialog-docs">
              <h3>Custom Force Parameters</h3>
              <p>Configure parameters for built-in force field functions.</p>

              <h4>Wave</h4>
              <p>Creates a wave effect, oscillating particles perpendicular to the force direction.</p>
              <pre><code>{
  "frequency": 1,
  "amplitude": 50
}</code></pre>
              <ul>
                <li><code>frequency</code> - Oscillations per second (default: 1)</li>
                <li><code>amplitude</code> - Distance particles are pushed side to side (default: 50)</li>
              </ul>

              <h4>Vortex</h4>
              <p>Creates a vortex effect, causing particles to spiral around a center point.</p>
              <pre><code>{
  "center": { "x": 400, "y": 300 },
  "strength": 1,
  "range": 100,
  "clockwise": false
}</code></pre>
              <ul>
                <li><code>center</code> - Required. Center point of the vortex (vec2)</li>
                <li><code>strength</code> - How strongly particles are pulled (default: 1)</li>
                <li><code>range</code> - Distance from center where effect applies (default: 100)</li>
                <li><code>clockwise</code> - Spiral direction (default: false)</li>
              </ul>

              <h4>Orbital</h4>
              <p>Creates an orbital effect, causing particles to orbit around a center point.</p>
              <pre><code>{
  "center": { "x": 400, "y": 300 },
  "strength": 1,
  "range": 100
}</code></pre>
              <ul>
                <li><code>center</code> - Required. Center point of the orbit (vec2)</li>
                <li><code>strength</code> - How strongly particles are pulled into orbit (default: 1)</li>
                <li><code>range</code> - Distance from center where effect applies (default: 100)</li>
              </ul>

              <h4>Vector Field</h4>
              <p>Creates a vector field using noise for complex, flowing motion patterns.</p>
              <pre><code>{
  "noise": null,
  "noiseScale": 0.01,
  "timeScale": 0.1,
  "forceAmount": 100
}</code></pre>
              <ul>
                <li><code>noise</code> - Required. Noise function: <code>(x, y, z) => number</code> (returns [-1, 1])</li>
                <li><code>noiseScale</code> - Size of noise features (smaller = smoother) (default: 0.01)</li>
                <li><code>timeScale</code> - Speed of field changes (default: 0.1)</li>
                <li><code>forceAmount</code> - Strength of particle effect (default: 100)</li>
              </ul>
              <p><strong>Note:</strong> The noise function must be provided programmatically (cannot be edited in JSON).</p>

              <h4>Turbulence</h4>
              <p>Creates turbulence using random forces for chaotic, jittery motion.</p>
              <pre><code>{
  "strength": 100,
  "frequency": 10
}</code></pre>
              <ul>
                <li><code>strength</code> - How strongly particles are affected (default: 100)</li>
                <li><code>frequency</code> - How often random force changes (default: 10)</li>
              </ul>

              <h4>Drag</h4>
              <p>Creates a drag effect, simulating air resistance or friction.</p>
              <pre><code>{
  "coefficient": 0.5
}</code></pre>
              <ul>
                <li><code>coefficient</code> - Amount of drag (0 = none, 1 = maximum) (default: 0.5)</li>
              </ul>

              <h4>Boids</h4>
              <p>Implements flocking behavior with separation, alignment, and cohesion.</p>
              <pre><code>{
  "separationDistance": 25,
  "alignmentDistance": 50,
  "cohesionDistance": 50,
  "separationWeight": 1.5,
  "alignmentWeight": 1.0,
  "cohesionWeight": 1.0
}</code></pre>
              <ul>
                <li><code>separationDistance</code> - How close is too close (default: 25)</li>
                <li><code>alignmentDistance</code> - Range for alignment behavior (default: 50)</li>
                <li><code>cohesionDistance</code> - Range for cohesion behavior (default: 50)</li>
                <li><code>separationWeight</code> - Strength of separation force (default: 1.5)</li>
                <li><code>alignmentWeight</code> - Strength of alignment force (default: 1.0)</li>
                <li><code>cohesionWeight</code> - Strength of cohesion force (default: 1.0)</li>
              </ul>
              <p><strong>Warning:</strong> O(nÂ²) complexity. Only use with &lt;200 particles.</p>
            </div>
            <div class="options-dialog-editor">
              <div id="custom-force-params-json-editor"></div>
            </div>
          </div>
          <div slot="footer">
            <button id="custom-force-params-ok-button">OK</button>
            <button id="custom-force-params-cancel-button">Cancel</button>
          </div>
        </e2-dialog>
      </e2-app>
    </main>
  </body>
</html>
